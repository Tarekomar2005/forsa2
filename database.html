<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قاعدة البيانات - Forsa</title>
    <style>
        body {
            font-family: 'Cairo', Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .db-status {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-decoration: none;
            color: white;
        }
        
        .btn-primary { background: linear-gradient(135deg, #3498db, #2980b9); }
        .btn-success { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .btn-warning { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .btn-info { background: linear-gradient(135deg, #17a2b8, #138496); }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .data-section {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 30px 0;
        }
        
        .section-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            font-size: 1.2em;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .order-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-new { background: #e8f5e8; color: #27ae60; }
        .status-processing { background: #fff3cd; color: #856404; }
        .status-completed { background: #d1ecf1; color: #0c5460; }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .sql-console {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            display: none;
        }
        
        .sql-input {
            background: #34495e;
            color: white;
            border: none;
            padding: 10px;
            width: 100%;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-database"></i> قاعدة البيانات - Forsa</h1>
        
        <div class="db-status">
            <i class="fas fa-server"></i> قاعدة البيانات المحلية نشطة - SQLite محاكي
        </div>
        
        <div class="stats" id="statsContainer">
            <div class="stat-card">
                <div class="stat-number" id="totalOrders">0</div>
                <div class="stat-label">إجمالي الطلبات</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalRevenue">0</div>
                <div class="stat-label">إجمالي الإيرادات (جنيه)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCustomers">0</div>
                <div class="stat-label">العملاء</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="dbSize">0</div>
                <div class="stat-label">حجم قاعدة البيانات (KB)</div>
            </div>
        </div>
        
        <div class="actions">
            <button class="btn btn-primary" onclick="refreshDatabase()">
                <i class="fas fa-sync-alt"></i> تحديث البيانات
            </button>
            <button class="btn btn-success" onclick="addTestOrder()">
                <i class="fas fa-plus"></i> إضافة طلب تجريبي
            </button>
            <button class="btn btn-info" onclick="toggleSQLConsole()">
                <i class="fas fa-terminal"></i> وحدة التحكم SQL
            </button>
            <button class="btn btn-warning" onclick="exportDatabase()">
                <i class="fas fa-download"></i> تصدير قاعدة البيانات
            </button>
            <button class="btn btn-danger" onclick="clearDatabase()">
                <i class="fas fa-trash"></i> مسح قاعدة البيانات
            </button>
        </div>
        
        <div class="sql-console" id="sqlConsole">
            <h4><i class="fas fa-terminal"></i> وحدة التحكم SQL</h4>
            <p>أدخل استعلام SQL:</p>
            <input type="text" class="sql-input" id="sqlInput" placeholder="SELECT * FROM orders WHERE status = 'new'">
            <button class="btn btn-info" onclick="executeSQLQuery()" style="margin-top: 10px;">
                <i class="fas fa-play"></i> تنفيذ الاستعلام
            </button>
            <div id="sqlResults" style="margin-top: 15px;"></div>
        </div>
        
        <div class="data-section">
            <div class="section-header">
                <span><i class="fas fa-shopping-cart"></i> جدول الطلبات (orders)</span>
                <span id="ordersCount">0 طلب</span>
            </div>
            <div style="overflow-x: auto;">
                <table id="ordersTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>رقم الطلب</th>
                            <th>العميل</th>
                            <th>الهاتف</th>
                            <th>المبلغ</th>
                            <th>الحالة</th>
                            <th>التاريخ</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <tr>
                            <td colspan="8" class="empty-state">
                                <i class="fas fa-database"></i>
                                <h3>لا توجد طلبات في قاعدة البيانات</h3>
                                <p>اضغط "إضافة طلب تجريبي" لبدء التجربة</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="data-section">
            <div class="section-header">
                <span><i class="fas fa-users"></i> جدول العملاء (customers)</span>
                <span id="customersCount">0 عميل</span>
            </div>
            <div style="overflow-x: auto;">
                <table id="customersTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>الاسم</th>
                            <th>الهاتف</th>
                            <th>البريد الإلكتروني</th>
                            <th>المدينة</th>
                            <th>عدد الطلبات</th>
                        </tr>
                    </thead>
                    <tbody id="customersTableBody">
                        <tr>
                            <td colspan="6" class="empty-state">
                                <i class="fas fa-users"></i>
                                <h3>لا يوجد عملاء في قاعدة البيانات</h3>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Simple SQL-like Database System
        class LocalSQLDatabase {
            constructor() {
                this.tables = {
                    orders: [],
                    customers: [],
                    products: []
                };
                this.init();
            }
            
            init() {
                this.loadFromStorage();
                this.updateStats();
                this.displayTables();
            }
            
            // CRUD Operations
            insert(table, data) {
                if (!this.tables[table]) {
                    throw new Error(`Table '${table}' does not exist`);
                }
                
                const id = this.generateId();
                const record = { id, ...data, created_at: new Date().toISOString() };
                this.tables[table].push(record);
                this.saveToStorage();
                return id;
            }
            
            select(table, where = null) {
                if (!this.tables[table]) return [];
                
                let results = this.tables[table];
                
                if (where) {
                    results = results.filter(record => {
                        return Object.keys(where).every(key => 
                            record[key] === where[key]
                        );
                    });
                }
                
                return results;
            }
            
            update(table, id, data) {
                if (!this.tables[table]) return false;
                
                const index = this.tables[table].findIndex(record => record.id === id);
                if (index === -1) return false;
                
                this.tables[table][index] = { 
                    ...this.tables[table][index], 
                    ...data, 
                    updated_at: new Date().toISOString() 
                };
                this.saveToStorage();
                return true;
            }
            
            delete(table, id) {
                if (!this.tables[table]) return false;
                
                const index = this.tables[table].findIndex(record => record.id === id);
                if (index === -1) return false;
                
                this.tables[table].splice(index, 1);
                this.saveToStorage();
                return true;
            }
            
            // SQL-like queries
            executeSQL(query) {
                const trimmedQuery = query.trim().toLowerCase();
                
                if (trimmedQuery.startsWith('select')) {
                    return this.executeSelect(query);
                } else if (trimmedQuery.startsWith('insert')) {
                    return this.executeInsert(query);
                } else if (trimmedQuery.startsWith('update')) {
                    return this.executeUpdate(query);
                } else if (trimmedQuery.startsWith('delete')) {
                    return this.executeDelete(query);
                }
                
                throw new Error('Unsupported SQL command');
            }
            
            executeSelect(query) {
                // Simple SELECT parser
                const tableMatch = query.match(/from\s+(\w+)/i);
                if (!tableMatch) throw new Error('Invalid SELECT query');
                
                const tableName = tableMatch[1];
                return this.select(tableName);
            }
            
            generateId() {
                return Date.now() + Math.random().toString(36).substr(2, 9);
            }
            
            loadFromStorage() {
                const stored = localStorage.getItem('forsa_sql_database');
                if (stored) {
                    this.tables = JSON.parse(stored);
                }
            }
            
            saveToStorage() {
                localStorage.setItem('forsa_sql_database', JSON.stringify(this.tables));
            }
            
            getStats() {
                const orders = this.tables.orders || [];
                const customers = this.tables.customers || [];
                
                const totalRevenue = orders.reduce((sum, order) => 
                    sum + (parseFloat(order.total_amount) || 0), 0
                );
                
                const dbSize = JSON.stringify(this.tables).length;
                
                return {
                    totalOrders: orders.length,
                    totalCustomers: customers.length,
                    totalRevenue: totalRevenue,
                    dbSize: Math.round(dbSize / 1024)
                };
            }
            
            updateStats() {
                const stats = this.getStats();
                document.getElementById('totalOrders').textContent = stats.totalOrders;
                document.getElementById('totalRevenue').textContent = stats.totalRevenue.toLocaleString();
                document.getElementById('totalCustomers').textContent = stats.totalCustomers;
                document.getElementById('dbSize').textContent = stats.dbSize;
                document.getElementById('ordersCount').textContent = stats.totalOrders + ' طلب';
                document.getElementById('customersCount').textContent = stats.totalCustomers + ' عميل';
            }
            
            displayTables() {
                this.displayOrders();
                this.displayCustomers();
            }
            
            displayOrders() {
                const orders = this.tables.orders || [];
                const tbody = document.getElementById('ordersTableBody');
                
                if (orders.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" class="empty-state">
                                <i class="fas fa-database"></i>
                                <h3>لا توجد طلبات في قاعدة البيانات</h3>
                                <p>اضغط "إضافة طلب تجريبي" لبدء التجربة</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = orders.map(order => `
                    <tr>
                        <td>${order.id.substr(-6)}</td>
                        <td>${order.order_number || 'N/A'}</td>
                        <td>${order.customer_name || 'N/A'}</td>
                        <td>${order.customer_phone || 'N/A'}</td>
                        <td>${order.total_amount || 0} جنيه</td>
                        <td><span class="order-status status-${order.status || 'new'}">${this.getStatusText(order.status)}</span></td>
                        <td>${new Date(order.created_at).toLocaleDateString('ar-EG')}</td>
                        <td>
                            <button onclick="db.delete('orders', '${order.id}'); db.init();" style="background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                                حذف
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
            
            displayCustomers() {
                const customers = this.tables.customers || [];
                const tbody = document.getElementById('customersTableBody');
                
                if (customers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="empty-state">
                                <i class="fas fa-users"></i>
                                <h3>لا يوجد عملاء في قاعدة البيانات</h3>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = customers.map(customer => {
                    const orderCount = this.tables.orders.filter(order => 
                        order.customer_phone === customer.phone
                    ).length;
                    
                    return `
                        <tr>
                            <td>${customer.id.substr(-6)}</td>
                            <td>${customer.name}</td>
                            <td>${customer.phone}</td>
                            <td>${customer.email || 'N/A'}</td>
                            <td>${customer.city || 'N/A'}</td>
                            <td>${orderCount}</td>
                        </tr>
                    `;
                }).join('');
            }
            
            getStatusText(status) {
                const statusMap = {
                    'new': 'جديد',
                    'processing': 'قيد المعالجة',
                    'completed': 'مكتمل',
                    'cancelled': 'ملغي'
                };
                return statusMap[status] || 'جديد';
            }
        }
        
        // Initialize database
        const db = new LocalSQLDatabase();
        
        // UI Functions
        function refreshDatabase() {
            db.init();
            showNotification('تم تحديث قاعدة البيانات!', 'success');
        }
        
        function addTestOrder() {
            // Add test customer
            const customerId = db.insert('customers', {
                name: 'عميل تجريبي ' + Math.floor(Math.random() * 100),
                phone: '010' + Math.floor(Math.random() * 90000000 + 10000000),
                email: 'test@customer.com',
                city: 'القاهرة'
            });
            
            // Add test order
            const orderId = db.insert('orders', {
                order_number: 'ORD-' + Date.now(),
                customer_name: 'عميل تجريبي',
                customer_phone: '01234567890',
                customer_email: 'test@customer.com',
                total_amount: Math.floor(Math.random() * 1000) + 200,
                status: 'new',
                payment_method: 'cash_on_delivery'
            });
            
            db.init();
            showNotification('تم إضافة طلب تجريبي بنجاح!', 'success');
        }
        
        function toggleSQLConsole() {
            const console = document.getElementById('sqlConsole');
            console.style.display = console.style.display === 'none' ? 'block' : 'none';
        }
        
        function executeSQLQuery() {
            const query = document.getElementById('sqlInput').value;
            const resultsDiv = document.getElementById('sqlResults');
            
            try {
                const results = db.executeSQL(query);
                resultsDiv.innerHTML = `
                    <h5>نتائج الاستعلام:</h5>
                    <pre style="background: #34495e; padding: 10px; border-radius: 5px; overflow-x: auto;">
${JSON.stringify(results, null, 2)}
                    </pre>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div style="color: #e74c3c;">
                        <h5>خطأ في الاستعلام:</h5>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function exportDatabase() {
            const data = {
                exported_at: new Date().toISOString(),
                database: db.tables,
                stats: db.getStats()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `forsa_database_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('تم تصدير قاعدة البيانات!', 'success');
        }
        
        function clearDatabase() {
            if (confirm('هل أنت متأكد من حذف جميع البيانات في قاعدة البيانات؟')) {
                localStorage.removeItem('forsa_sql_database');
                db.tables = { orders: [], customers: [], products: [] };
                db.init();
                showNotification('تم مسح قاعدة البيانات!', 'warning');
            }
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#f39c12'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                font-weight: bold;
                transform: translateX(400px);
                transition: transform 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            db.init();
        });
    </script>
</body>
</html>