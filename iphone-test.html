<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± iPhone - Forsa</title>
    <style>
        body {
            font-family: 'Cairo', Arial, sans-serif;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: linear-gradient(135deg, #f8f6f3 0%, #f5f3f0 50%, #f0e6c7 100%);
        }
        
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #b02e2e;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .step {
            background: #e7f3ff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-right: 4px solid #b02e2e;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        
        button {
            background: linear-gradient(135deg, #b02e2e, #d63447);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            width: 100%;
        }
        
        .url-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 16px; /* Prevents zoom on iOS */
        }
        
        .device-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ“± Ø§Ø®ØªØ¨Ø§Ø± Ø®Ø§Øµ Ø¨Ù€ iPhone</h1>
        
        <div id="deviceInfo" class="device-info">
            <div>ğŸ“± Ø§Ù„Ø¬Ù‡Ø§Ø²: <span id="deviceType">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span></div>
            <div>ğŸŒ Ø§Ù„Ù…ØªØµÙØ­: <span id="browserType">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span></div>
            <div>ğŸ“± iOS: <span id="iosVersion">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span></div>
            <div>ğŸ”— Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©: <span id="popupStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span></div>
        </div>
        
        <div class="step">
            <h3>ğŸ”§ Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¹Ø¯Ø§Ø¯ Google Sheets</h3>
            <input type="url" id="gsUrl" class="url-input" 
                   placeholder="Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· Google Apps Script">
            <button onclick="testGoogleSheets()">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Google Sheets</button>
            <div id="gsResults"></div>
        </div>
        
        <div class="step">
            <h3>ğŸ“² Ø§Ù„Ø®Ø·ÙˆØ© 2: Ù…Ø­Ø§ÙƒØ§Ø© Ø·Ù„Ø¨ Ù…Ù† iPhone</h3>
            <button onclick="simulateIPhoneOrder()">ğŸ“± Ø¹Ù…Ù„ Ø·Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ù† iPhone</button>
            <div id="orderResults"></div>
        </div>
        
        <div class="step">
            <h3>ğŸ” Ø§Ù„Ø®Ø·ÙˆØ© 3: ÙØ­Øµ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
            <button onclick="openAdminPanel()">ğŸ–¥ï¸ ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
            <button onclick="checkLocalData()">ğŸ“Š ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©</button>
            <div id="adminResults"></div>
        </div>
        
        <div class="step">
            <h3>ğŸ”§ Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø§Ø®ØªØ¨Ø§Ø± Ø®Ø§Øµ Ø¨Ù€ Safari</h3>
            <button onclick="testSafariFeatures()">ğŸ§­ Ø§Ø®ØªØ¨Ø§Ø± Safari Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</button>
            <div id="safariResults"></div>
        </div>
    </div>

    <script>
        // Detect device and browser information
        function detectDevice() {
            const ua = navigator.userAgent;
            const deviceType = document.getElementById('deviceType');
            const browserType = document.getElementById('browserType');
            const iosVersion = document.getElementById('iosVersion');
            
            // Device detection
            if (/iPhone|iPad|iPod/.test(ua)) {
                deviceType.textContent = 'iOS Device âœ…';
                deviceType.style.color = '#28a745';
                
                // iOS version
                const iosMatch = ua.match(/OS (\\d+)_(\\d+)/);
                if (iosMatch) {
                    iosVersion.textContent = `iOS ${iosMatch[1]}.${iosMatch[2]} âœ…`;
                    iosVersion.style.color = '#28a745';
                }
            } else {
                deviceType.textContent = 'Ù„ÙŠØ³ iOS âš ï¸';
                deviceType.style.color = '#ffc107';
            }
            
            // Browser detection
            if (/Safari/.test(ua) && !/Chrome/.test(ua)) {
                browserType.textContent = 'Safari âœ…';
                browserType.style.color = '#28a745';
            } else if (/Chrome/.test(ua)) {
                browserType.textContent = 'Chrome âš ï¸';
                browserType.style.color = '#ffc107';
            } else {
                browserType.textContent = 'Other Browser â“';
                browserType.style.color = '#6c757d';
            }
        }
        
        async function testGoogleSheets() {
            const gsUrl = document.getElementById('gsUrl').value.trim();
            const resultsDiv = document.getElementById('gsResults');
            
            if (!gsUrl) {
                resultsDiv.innerHTML = '<div class="status error">âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Google Apps Script</div>';
                return;
            }
            
            localStorage.setItem('forsa_google_sheets_url', gsUrl);
            resultsDiv.innerHTML = '<div class="status info">â³ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...</div>';
            
            let results = '';
            
            // Test POST
            try {
                const testData = {
                    action: 'saveContact',
                    name: 'Ø§Ø®ØªØ¨Ø§Ø± iPhone - ' + new Date().toLocaleTimeString(),
                    email: 'iphone-test@forsa.com',
                    message: 'Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø¬Ù‡Ø§Ø² iPhone - ' + navigator.userAgent,
                    source: 'iphone_test'
                };
                
                await fetch(gsUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                results += '<div class="status success">âœ… POST (Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª): Ù†Ø¬Ø­</div>';
            } catch (error) {
                results += '<div class="status error">âŒ POST ÙØ´Ù„: ' + error.message + '</div>';
            }
            
            // Test GET
            try {
                const getUrl = gsUrl + '?action=getCompleteOrders&timestamp=' + Date.now();
                const response = await fetch(getUrl, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    results += '<div class="status success">âœ… GET (Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª): Ù†Ø¬Ø­ - ' + (data.data ? data.data.length : 0) + ' Ø·Ù„Ø¨Ø§Øª</div>';
                } else {
                    results += '<div class="status error">âŒ GET ÙØ´Ù„: HTTP ' + response.status + '</div>';
                }
            } catch (error) {
                results += '<div class="status error">âŒ GET ÙØ´Ù„: ' + error.message + '</div>';
            }
            
            resultsDiv.innerHTML = results;
        }
        
        function simulateIPhoneOrder() {
            const resultsDiv = document.getElementById('orderResults');
            
            const iPhoneOrder = {
                id: 'iphone_' + Date.now(),
                orderId: 'IPHONE-' + Math.floor(Math.random() * 10000),
                timestamp: new Date().toISOString(),
                customerName: 'Ø¹Ù…ÙŠÙ„Ø© Ù…Ù† iPhone',
                customerPhone: '010' + Math.floor(Math.random() * 100000000).toString().padStart(8, '0'),
                customerEmail: 'iphone-customer@example.com',
                customerCity: 'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©',
                customerAddress: 'Ø´Ø§Ø±Ø¹ Ø§Ù„Ù†ÙŠÙ„ - Ù…Ù† iPhone',
                paymentMethod: 'cash_on_delivery',
                customerNotes: 'Ø·Ù„Ø¨ Ù…Ù† iPhone - ' + navigator.userAgent.substring(0, 50),
                products: [
                    {
                        name: 'Ø­Ù‚ÙŠØ¨Ø© ÙŠØ¯ Ø£Ù†ÙŠÙ‚Ø©',
                        category: 'Ø­Ù‚Ø§Ø¦Ø¨ ÙŠØ¯',
                        price: '750',
                        quantity: 1
                    }
                ],
                totalItems: 1,
                totalAmount: 750,
                source: 'iphone_real_test',
                synced: false,
                deviceInfo: 'iPhone - ' + (navigator.userAgent.match(/iPhone OS ([0-9_]+)/) || ['', 'Unknown'])[1].replace(/_/g, '.'),
                isIPhoneTest: true
            };
            
            // Save to localStorage
            const completeOrders = JSON.parse(localStorage.getItem('forsa_complete_orders') || '[]');
            completeOrders.push(iPhoneOrder);
            localStorage.setItem('forsa_complete_orders', JSON.stringify(completeOrders));
            
            resultsDiv.innerHTML = '<div class="status success">âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ù† iPhone!<br>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ' + iPhoneOrder.orderId + '<br>Ø§Ù„Ø¢Ù† Ø§ÙØ­Øµ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>';
        }
        
        function openAdminPanel() {
            const resultsDiv = document.getElementById('adminResults');
            
            try {
                const adminWindow = window.open('admin-panel.html', '_blank', 'width=1200,height=800');
                if (adminWindow) {
                    resultsDiv.innerHTML = '<div class="status success">âœ… ØªÙ… ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>';
                } else {
                    resultsDiv.innerHTML = '<div class="status warning">âš ï¸ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù…Ø­Ø¬ÙˆØ¨Ø©. Ø§ÙØªØ­ admin-panel.html ÙŠØ¯ÙˆÙŠØ§Ù‹</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = '<div class="status error">âŒ Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: ' + error.message + '</div>';
            }
        }
        
        function checkLocalData() {
            const resultsDiv = document.getElementById('adminResults');
            
            const contacts = JSON.parse(localStorage.getItem('forsa_contacts') || '[]');
            const completeOrders = JSON.parse(localStorage.getItem('forsa_complete_orders') || '[]');
            
            let results = '<div class="status info">ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©:</div>';
            results += '<div class="status info">ğŸ“§ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„: ' + contacts.length + '</div>';
            results += '<div class="status info">ğŸ›ï¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©: ' + completeOrders.length + '</div>';
            
            // Count iPhone orders
            const iPhoneOrders = completeOrders.filter(o => o.source && o.source.includes('iphone'));
            if (iPhoneOrders.length > 0) {
                results += '<div class="status success">ğŸ“± Ø·Ù„Ø¨Ø§Øª iPhone: ' + iPhoneOrders.length + '</div>';
            }
            
            resultsDiv.innerHTML = results;
        }
        
        function testSafariFeatures() {
            const resultsDiv = document.getElementById('safariResults');
            
            let results = '<div class="status info">ğŸ§­ Ø§Ø®ØªØ¨Ø§Ø± Safari Ø§Ù„Ù…ØªÙ‚Ø¯Ù…:</div>';
            
            // Test localStorage
            try {
                localStorage.setItem('safari_test', 'test');
                localStorage.removeItem('safari_test');
                results += '<div class="status success">âœ… localStorage: ÙŠØ¹Ù…Ù„</div>';
            } catch (error) {
                results += '<div class="status error">âŒ localStorage: Ù„Ø§ ÙŠØ¹Ù…Ù„ - ' + error.message + '</div>';
            }
            
            // Test fetch API
            if (typeof fetch !== 'undefined') {
                results += '<div class="status success">âœ… Fetch API: Ù…ØªÙˆÙØ±</div>';
            } else {
                results += '<div class="status error">âŒ Fetch API: ØºÙŠØ± Ù…ØªÙˆÙØ±</div>';
            }
            
            // Test popup capability
            const popupStatus = document.getElementById('popupStatus');
            try {
                const testWindow = window.open('', '_blank', 'width=1,height=1');
                if (testWindow) {
                    testWindow.close();
                    results += '<div class="status success">âœ… Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©: Ù…Ø³Ù…ÙˆØ­Ø©</div>';
                    popupStatus.textContent = 'Ù…Ø³Ù…ÙˆØ­Ø© âœ…';
                    popupStatus.style.color = '#28a745';
                } else {
                    results += '<div class="status warning">âš ï¸ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©: Ù…Ø­Ø¬ÙˆØ¨Ø©</div>';
                    popupStatus.textContent = 'Ù…Ø­Ø¬ÙˆØ¨Ø© âš ï¸';
                    popupStatus.style.color = '#ffc107';
                }
            } catch (error) {
                results += '<div class="status error">âŒ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©: Ø®Ø·Ø£ - ' + error.message + '</div>';
                popupStatus.textContent = 'Ø®Ø·Ø£ âŒ';
                popupStatus.style.color = '#dc3545';
            }
            
            // Check Safari version
            if (/Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent)) {
                const safariVersion = navigator.userAgent.match(/Version\\/([0-9.]+)/);
                if (safariVersion) {
                    results += '<div class="status info">ğŸ§­ Safari Version: ' + safariVersion[1] + '</div>';
                }
            }
            
            resultsDiv.innerHTML = results;
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            detectDevice();
            
            // Load saved Google Sheets URL
            const savedUrl = localStorage.getItem('forsa_google_sheets_url');
            if (savedUrl && savedUrl !== 'PASTE_YOUR_WEB_APP_URL_HERE') {
                document.getElementById('gsUrl').value = savedUrl;
            }
        });
    </script>
</body>
</html>